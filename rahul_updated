pipeline {
    agent any	
	parameters {
    choice choices: ['tetrapak-customerhub', 'tetrapak-publicweb'], description: '', name: 'CHOICE'
                }
    tools {
        maven 'maven'
        jdk 'jdk8'
    }
	
	environment {
     sonar_url = "http://127.0.0.1:9000"
	 author_url = "http://10.202.13.228:4502"
	 publish_url = "http://10.202.13.229:4503"
	 package_name = "tetrapak-complete-package"
	 test_url = "http://tetrapak.sapient.com/content/tetrapak/customerhub/global/dashboard.html http://tetrapak.sapient.com/content/tetrapak/customerhub/global/installed-equipment.html http://tetrapak.sapient.com/content/tetrapak/customerhub/global/ordering/order-history.html  http://tetrapak.sapient.com/content/tetrapak/customerhub/global/financials.html  http://tetrapak.sapient.com/content/tetrapak/customerhub/global/training.html  http://tetrapak.sapient.com/content/tetrapak/customerhub/global/projects.html  http://tetrapak.sapient.com/content/tetrapak/customerhub/global/contact.html http://tetrapak.sapient.com/content/tetrapak/customerhub/global/about-us.html "
	 test_url_pally_zap = "http://tetrapak.sapient.com"
	 karmapath =  "${workspace}/${params.CHOICE}/ui.dev/src/coverage"
   }
   
	stages {
		stage ('Initialize') {
			steps {
				sh '''
					echo "PATH = ${PATH}"
					echo "M2_HOME = ${M2_HOME}"
				'''
			}
		}

		
    stage ('Dispatcher Flush') {
		    steps {
            echo "Cache Flush Started"
			sh "curl -X POST --header 'CQ-Action: Delete' --header CQ-Handle:/home --header CQ-Page:/home 'http://10.202.13.229/dispatcher/invalidate.cache'"
			sh "curl -X POST --header 'CQ-Action: Delete' --header CQ-Handle:/content --header CQ-Page:/content 'http://10.202.13.229/dispatcher/invalidate.cache'"
			sh "curl -X POST --header 'CQ-Action: Delete' --header CQ-Handle:/etc --header CQ-Page:/etc 'http://10.202.13.229/dispatcher/invalidate.cache'"
			sh "curl -X POST --header 'CQ-Action: Delete' --header CQ-Handle:/libs --header CQ-Page:/libs 'http://10.202.13.229/dispatcher/invalidate.cache'"


			}
		}
		
	stage ('Mail') {		  
		    steps {
			mail bcc: '', body: 'Please check the pipline log', cc: 'rahul.azad@publicissapient.com', from: '', replyTo: '', subject: 'Tetrapack_Dev', to: 'rahul.azad@publicissapient.com'
			}
		    }
		}
    }
	