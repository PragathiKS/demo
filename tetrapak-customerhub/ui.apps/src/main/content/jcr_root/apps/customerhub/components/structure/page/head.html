<template data-sly-template.head="${ @ page,pageHeadModel }"
          data-sly-use.headlibRenderer="headlibs.html"
          data-sly-use.headResources="head.resources.html">
    <meta charset="UTF-8">
    <title>${page.title}</title>
    <link rel="icon" type="image/png" href="/content/dam/tetrapak/customerhub/TetraPak.png">

    <meta data-sly-test.keywords="${page.keywords}" name="keywords" content="${keywords}"/>
    <meta data-sly-test.description="${properties['jcr:description']}" name="description" content="${description}"/>
    <meta data-sly-test.templateName="${page.templateName}" name="template" content="${templateName}"/>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <sly data-sly-use.headerGlobalUtil="com.tetrapak.customerhub.core.utils.GlobalUtil"></sly>
    <sly data-sly-test="${headerGlobalUtil.isPublish}">
      <script type="text/javascript" defer>
        var cuoneTrustValue = '${pageHeadModel.cookieTokenServletUrl @ context="unsafe"}';
      </script>
    </sly>
    
    <sly data-sly-test="${headerGlobalUtil.isPublish}">
      <!-- <script>
        var OneTrust = {
          dataSubjectParams: {
            id: '',
            isAnonymous: false,
            token: ''
          }
        }
      </script> -->
      <script type="text/javascript" defer>
        var OneTrust = {
          dataSubjectParams: {
            id: '',
            isAnonymous: false,
            token: ''
          }
        };
        (function () {
          var cookieValue, isCookieExist, cuoneTrustValue, uidValue, jwtToken;
          function getCookie(name) {
            var value = "; " + document.cookie;
            var parts = value.split("; " + name + "=");
            if (parts.length == 2) return parts.pop().split(";").shift();
            else return null;
          }
          function getCookieValue() {
            var myCookie = getCookie("TPCOOKIEUSER");
            cookieValue = myCookie;
            if (myCookie == null) {
              return false;
            } else {
              return true;
            }
          }
  
          isCookieExist = getCookieValue();
  
          function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            var domain = ".tetrapak.com";
            d.setTime(d.getTime() + exdays * 24 * 60 * 60 * 1000);
            let expires = "expires=" + d.toUTCString();
            document.cookie = document.cookie =
              cname +
              "=" +
              cvalue +
              ";expires=" +
              expires +
              ";domain=" +
              domain +
              ";path=/";
          }
  
          // Url for the request
          cuoneTrustValue = window.cuoneTrustValue + "?UserID=" + cookieValue;
          fetch(cuoneTrustValue)
            .then((response) => {
              return response.json();
            })
            .then((data) => {
              uidValue = data.uid;
              jwtToken = data.jwt;
              localStorage.setItem("uidValueset", uidValue);
              localStorage.setItem("jwttokenset", jwtToken);
              setCookie("TPCOOKIEUSER", uidValue, 365);
              OneTrust.dataSubjectParams.id = uidValue;
              OneTrust.dataSubjectParams.token = jwtToken;
            })
            .catch(function (error) {
              console.log(error);
            });
        })();
  
        //# sourceURL=cookieDebug.js
      </script>
    </sly>
    <sly data-sly-test="${headerGlobalUtil.isPublish && headerGlobalUtil.dataDomainScript}">
    	<script src="https://cdn.cookielaw.org/consent/${headerGlobalUtil.dataDomainScript}/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="${headerGlobalUtil.dataDomainScript}" ></script>
        <script type="text/javascript">
          function OptanonWrapper() { }
      </script>
    </sly>
    <sly data-sly-include="customheaderlibs.html"></sly>
    <sly data-sly-call="${headlibRenderer.headlibs @
                                designPath         = page.designPath,
                                staticDesignPath   = page.staticDesignPath,
                                clientLibCategories = page.clientLibCategories}"></sly>
    <sly data-sly-test.appResourcesPath=${page.appResourcesPath} data-sly-call="${headResources.favicons @ path = appResourcesPath}"></sly>

	<sly data-sly-test="${headerGlobalUtil.isRunModeDevelopment || headerGlobalUtil.isRunModeQA}">
		<script src="//assets.adobedtm.com/launch-ENee1a586aa21a464abd3b7626503523ad-development.min.js" async></script>
	</sly>
	<sly data-sly-test="${headerGlobalUtil.isRunModeStaging || headerGlobalUtil.isRunModeProduction}">
	<sly data-sly-resource="${'cloudconfig-header' @ resourceType='cq/cloudconfig/components/scripttags/header'}"></sly> 
	</sly>
	</template>
