<template data-sly-template.head="${ @ page, digitalDataModel,pageHeadModel}"
          data-sly-use.headlibRenderer="headlibs.html"
          data-sly-use.headResources="head.resources.html"
          data-sly-use.thumbnailConfigModel="com.tetrapak.publicweb.core.models.ThumbnailConfigModel">

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>
        ${page.title @ context='scriptComment'} | ${inheritedPageProperties.titleSuffix ? inheritedPageProperties.titleSuffix : 'Tetra Pak'}
    </title>
    <link rel="icon" type="image/png" href="/content/dam/tetrapak/publicweb/favicon.png">
    <script>
        var digitalData = ${digitalDataModel.digitalData @ context="unsafe"};
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">


    <sly data-sly-test="${pageHeadModel.baiduMapkey}">
        <script src="https://api.map.baidu.com/api?v=3.0&ak=${pageHeadModel.baiduMapkey}"></script>
    </sly>
     <sly data-sly-test="${digitalDataModel.production && digitalDataModel.isPublisher}">
        <script src="//assets.adobedtm.com/launch-EN0d78cb162d36485d830065378e34eaa9.min.js" async></script>
    </sly>

    <sly data-sly-test="${digitalDataModel.staging && digitalDataModel.isPublisher}">
        <script src="//assets.adobedtm.com/launch-ENee1a586aa21a464abd3b7626503523ad-development.min.js" async></script>
    </sly>
   <!--/* script for DEV and QA */-->
    <sly data-sly-test="${digitalDataModel.development && digitalDataModel.isPublisher}">
      <script src="//assets.adobedtm.com/launch-ENee1a586aa21a464abd3b7626503523ad-development.min.js" async></script>
    </sly>
    <meta data-sly-test.keywords="${page.keywords}" name="keywords" content="${keywords}"/>
    <meta data-sly-test.description="${properties['jcr:description']}" name="description" content="${description @ context='scriptComment'}"/>
    <meta data-sly-test.templateName="${page.templateName}" name="template" content="${templateName}"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="robots" data-sly-test.indexVal="${properties.noIndex ? 'noindex' : 'index'}" data-sly-test.followVal="${properties.noFollow ? properties.noFollow : 'follow'}" content="${indexVal}, ${followVal}"/>
    <!--/* Start of SEO canonical and href functionality */-->
    <sly data-sly-test="${indexVal != 'noindex' && followVal != 'nofollow' && digitalDataModel.isPublisher}">
    <sly data-sly-test="${digitalDataModel.canonicalURL}">
        <link rel="canonical" href="${digitalDataModel.canonicalURL}" />
    </sly>
  <sly data-sly-test="${digitalDataModel.hreflangValues}">
    <sly data-sly-list.hreflangData="${digitalDataModel.hreflangValues}">
        <link rel="alternate" hreflang="${hreflangData.locale}" href="${hreflangData.pageUrl}" />
    </sly>
  </sly>
    </sly>
     <!--/* End of SEO canonical and href functionality */-->

  <meta data-sly-test="${properties['jcr:title']}" property="og:title" content="${properties['jcr:title'] @ context='scriptComment'}"/>
  <meta data-sly-test="${properties['jcr:description']}" property="og:description" content="${properties['jcr:description'] @ context='scriptComment'}"/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="${digitalDataModel.currentPageURL}"/>
  <meta data-sly-test="${properties['jcr:description']}" name="twitter:description" content="${properties['jcr:description'] @ context='scriptComment'}"/>
  <meta data-sly-test="${properties['jcr:title']}" name="twitter:title" content="${properties['jcr:title'] @ context='scriptComment'}"/>
  <meta name="twitter:site" content="@tetrapak" />
  <meta name="twitter:card" content="summary" />

  <sly data-sly-test="${thumbnailConfigModel.valid}"
       data-sly-use.dynamicMetaImage="${'com.tetrapak.publicweb.core.models.DynamicImageModel' @ imagePath=thumbnailConfigModel.openGraphImagePath, componentName='thumbnailConfig'}">
    <meta property="og:image" content="${dynamicMetaImage.desktopUrl}"/>
    <meta name="twitter:image" content="${dynamicMetaImage.desktopUrl}"/>
  </sly>

    <sly data-sly-include="customheaderlibs.html"></sly>
     <sly data-sly-call="${headlibRenderer.headlibs @
                                designPath         = page.designPath,
                                staticDesignPath   = page.staticDesignPath,
                                clientLibCategories = page.clientLibCategories,
                              clientLibCategoriesJsHead = page.clientLibCategoriesJsHead,
                               hasCloudconfigSupport     = page.hasCloudconfigSupport}"></sly>
    <sly data-sly-test.appResourcesPath=${page.appResourcesPath} data-sly-call="${headResources.favicons @ path = appResourcesPath}"></sly>


<sly data-sly-test ="${!digitalDataModel.isPublisher}">
   <script type="text/javascript">

      var cookieValue,
          isCookieExist,
          oneTrustValue,
          uidValue,
          jwtToken;

      function getCookie(name) {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length == 2) return parts.pop().split(";").shift();
        else return null;
      }
      function  getCookieValue() {
        var myCookie = getCookie("TPCOOKIEUSER");
        cookieValue= myCookie 
        if (myCookie == null) {
          return false
        }
        else {
            return true
      }
    }

      isCookieExist = getCookieValue()

      function setCookie(cname, cvalue, exdays) {
          const d = new Date();
          d.setTime(d.getTime() + (exdays*24*60*60*1000));
          let expires = "expires="+ d.toUTCString();
          document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

  
    // Url for the request 
  var oneTrustValue= '${pageHeadModel.cookieTokenServletUrl @ context="unsafe"}';
  oneTrustValue = oneTrustValue +"?UserID="+cookieValue
 if( (isCookieExist === false) ||(sessionStorage.getItem("jwttokenset") === null)){
	fetch(oneTrustValue)
    .then((response) => {
      return response.json()
    })
    .then((data) => {

	  uidValue = data.uid;
      jwtToken = data.jwt;
     sessionStorage.setItem("uidValueset", uidValue);
     sessionStorage.setItem("jwttokenset", jwtToken);
     setCookie("TPCOOKIEUSER", uidValue,365);
	  var head = document.getElementsByTagName('head')[0];
	  var sc = document.createElement('script');
	  var string ="var OneTrustValue ={dataSubjectParams:{id :'"+uidValue+"',isAnonymous: false,jwt: '"+jwtToken+"'}}";
    sc.appendChild(document.createTextNode(string));
        head.appendChild(sc);

    }).catch(function(error) {
      console.log(error);
    });
}
else {
		  var userid = sessionStorage.getItem("uidValueset");
      var jwt = sessionStorage.getItem("jwttokenset");
      var head = document.getElementsByTagName('head')[0];
	  	var sc = document.createElement('script');
		  var string ="var OneTrustValue = {dataSubjectParams: {id :'"+userid+"',isAnonymous: false,jwt: '"+jwt+"'}}";
      sc.appendChild(document.createTextNode(string));
      head.appendChild(sc);
 }

  </script>
</sly>

      <sly data-sly-test="${digitalDataModel.isPublisher && digitalDataModel.dataDomainScript}">
      <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="${digitalDataModel.dataDomainScript}" ></script>
      <script type="text/javascript">
        function OptanonWrapper() { }
      </script>
    </sly>
</template>